# EmailPanel ì»´í¬ë„ŒíŠ¸ ê°€ì´ë“œ

## ê°œìš”

`EmailPanel`ì€ Smart Assistant v1.1.7ì—ì„œ ì¶”ê°€ëœ ì´ë©”ì¼ í•„í„°ë§ íŒ¨ë„ ì»´í¬ë„ŒíŠ¸ì…ë‹ˆë‹¤. TODO ë¦¬ìŠ¤íŠ¸ì— í¬í•¨ë˜ì§€ ì•Šì€ ì´ë©”ì¼ë§Œ ìë™ìœ¼ë¡œ í•„í„°ë§í•˜ì—¬ ì¹´ë“œ í˜•íƒœë¡œ í‘œì‹œí•©ë‹ˆë‹¤.

**v1.2.1+++++++++++++++++++++++ ì—…ë°ì´íŠ¸**: ì´ë©”ì¼ í´ë¦­ ì‹œ ìƒì„¸ ë‹¤ì´ì–¼ë¡œê·¸ í‘œì‹œ ê¸°ëŠ¥ ì¶”ê°€ âœ¨

## ì£¼ìš” ê¸°ëŠ¥

### 1. TODO ê¸°ë°˜ í•„í„°ë§
TODO ë¦¬ìŠ¤íŠ¸ì— í¬í•¨ë˜ì§€ ì•Šì€ ì´ë©”ì¼ë§Œ ìë™ìœ¼ë¡œ í•„í„°ë§í•©ë‹ˆë‹¤:

- **ì¤‘ë³µ ë°©ì§€**: TODOë¡œ ë³€í™˜ëœ ì´ë©”ì¼ì€ ìë™ìœ¼ë¡œ ì œì™¸
- **ë©”ì‹œì§€ ID ì¶”ì **: `source_message.msg_id` ê¸°ë°˜ìœ¼ë¡œ ì •í™•í•œ í•„í„°ë§
- **ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸**: TODO ìƒì„± ì‹œ ìë™ìœ¼ë¡œ ì´ë©”ì¼ ëª©ë¡ ê°±ì‹ 

### 2. ì¹´ë“œ í˜•íƒœ UI
ê° ì´ë©”ì¼ì„ ì‹œê°ì ìœ¼ë¡œ êµ¬ë¶„ëœ ì¹´ë“œë¡œ í‘œì‹œí•©ë‹ˆë‹¤:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ì œëª©: í”„ë¡œì íŠ¸ ê²€í†  ìš”ì²­    ë°œì‹ : ê¹€ì² ìˆ˜ â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚ ë‚´ìš© ë¯¸ë¦¬ë³´ê¸° (ìµœëŒ€ 100ì)...        â”‚
â”‚                                     â”‚
â”‚ ìˆ˜ì‹ : 2025-10-17 14:30              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3. ì´ë©”ì¼ ìƒì„¸ ë³´ê¸° (v1.2.1+++++++++++++++++++++++ ì‹ ê·œ) âœ¨
ì´ë©”ì¼ í•­ëª© í´ë¦­ ì‹œ MessageDetailDialogë¡œ ì „ì²´ ë‚´ìš©ì„ í‘œì‹œí•©ë‹ˆë‹¤:

- **ì „ì²´ ë‚´ìš© í™•ì¸**: ë°œì‹ ì, ì œëª©, ì „ì²´ ë³¸ë¬¸
- **ìˆ˜ì‹ ì ì •ë³´**: TO, CC, BCC ëª©ë¡ í‘œì‹œ
- **í‚¤ë³´ë“œ ë‹¨ì¶•í‚¤**: 
  - `Enter`: ë©”ì‹œì§€ ì„ íƒ
  - `Esc`: ë‹¤ì´ì–¼ë¡œê·¸ ë‹«ê¸°
  - `â†‘/â†“`: ì´ì „/ë‹¤ìŒ ì´ë©”ì¼ íƒìƒ‰
- **ì¼ê´€ëœ UX**: MessageSummaryPanelê³¼ ë™ì¼í•œ ë‹¤ì´ì–¼ë¡œê·¸ ì‚¬ìš©

### 4. ì‹¤ì‹œê°„ ì¹´ìš´íŠ¸
í•„í„°ë§ëœ ì´ë©”ì¼ ìˆ˜ë¥¼ ì‹¤ì‹œê°„ìœ¼ë¡œ í‘œì‹œí•©ë‹ˆë‹¤.

### 5. í˜¸ë²„ íš¨ê³¼
ë§ˆìš°ìŠ¤ ì˜¤ë²„ ì‹œ ì‹œê°ì  í”¼ë“œë°±ì„ ì œê³µí•©ë‹ˆë‹¤.

## ì‚¬ìš© ë°©ë²•

### ê¸°ë³¸ ì‚¬ìš©
```python
from ui.email_panel import EmailPanel

# ì»´í¬ë„ŒíŠ¸ ìƒì„±
panel = EmailPanel()

# ë ˆì´ì•„ì›ƒì— ì¶”ê°€
layout.addWidget(panel)
```

### ì´ë©”ì¼ ì—…ë°ì´íŠ¸
```python
emails = [
    {
        "msg_id": "email_001",
        "type": "email",
        "subject": "í”„ë¡œì íŠ¸ ê²€í†  ìš”ì²­",
        "sender": "ê¹€ì² ìˆ˜",
        "body": "ì²¨ë¶€ëœ ë¬¸ì„œë¥¼ ê²€í† í•´ ì£¼ì„¸ìš”.",
        "timestamp": "2025-10-17 14:30",
        "recipients": ["pm@company.com"],
        "cc": ["team@company.com"]
    },
    {
        "msg_id": "email_002",
        "type": "email",
        "subject": "ì•ˆë…•í•˜ì„¸ìš”",
        "sender": "ì´ì˜í¬",
        "body": "ì˜ ì§€ë‚´ì‹œë‚˜ìš”?",
        "timestamp": "2025-10-17 15:00"
    }
]

# TODO ì•„ì´í…œ ëª©ë¡ (ì„ íƒì‚¬í•­)
todo_items = [
    {
        "id": "todo_001",
        "source_message": {
            "msg_id": "email_001"  # ì´ ì´ë©”ì¼ì€ í•„í„°ë§ì—ì„œ ì œì™¸ë¨
        }
    }
]

# ì´ë©”ì¼ ëª©ë¡ ì—…ë°ì´íŠ¸ (TODOì— ì—†ëŠ” ì´ë©”ì¼ë§Œ í‘œì‹œ)
panel.update_emails(emails, todo_items)
```

### ì´ˆê¸°í™”
```python
# ì´ë©”ì¼ ëª©ë¡ ì´ˆê¸°í™”
panel.clear()
```

## í†µí•© ì˜ˆì‹œ

### GUIì—ì„œ ì‚¬ìš©
```python
class SmartAssistantGUI(QMainWindow):
    def create_email_tab(self):
        """ì´ë©”ì¼ íƒ­ ìƒì„±"""
        tab = QWidget()
        layout = QVBoxLayout(tab)
        layout.setContentsMargins(0, 0, 0, 0)
        
        # EmailPanel ìƒì„±
        self.email_panel = EmailPanel()
        layout.addWidget(self.email_panel)
        
        return tab
    
    def handle_result(self, result: dict):
        """ë¶„ì„ ê²°ê³¼ ì²˜ë¦¬"""
        if not result.get("success"):
            return
        
        # ìˆ˜ì§‘ëœ ë©”ì‹œì§€ì—ì„œ ì´ë©”ì¼ë§Œ ì¶”ì¶œ
        messages = result.get("messages", [])
        emails = [m for m in messages if m.get("type") == "email"]
        
        # EmailPanel ì—…ë°ì´íŠ¸
        self.email_panel.update_emails(emails)
```

## UI ìŠ¤íƒ€ì¼ë§

ì»´í¬ë„ŒíŠ¸ëŠ” Tailwind CSS ìŠ¤íƒ€ì¼ì˜ ìƒ‰ìƒ íŒ”ë ˆíŠ¸ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤:

```python
# ì´ë©”ì¼ ì¹´ë“œ
QWidget {
    border: 1px solid #D1D5DB;
    border-radius: 10px;
    background: #FFFFFF;
}
QWidget:hover {
    border-color: #9CA3AF;
    background: #F9FAFB;
}

# í—¤ë”
QLabel {
    font-size: 16px;
    font-weight: 700;
    color: #1F2937;
}

# ì¹´ìš´íŠ¸ ë°°ì§€
QLabel {
    color: #6B7280;
    background: #F3F4F6;
    padding: 4px 12px;
    border-radius: 12px;
}
```

## ë°ì´í„° êµ¬ì¡°

### ì´ë©”ì¼ ë”•ì…”ë„ˆë¦¬ ìŠ¤í‚¤ë§ˆ
```python
{
    "msg_id": str,         # ë©”ì‹œì§€ ê³ ìœ  ID (í•„ìˆ˜)
    "type": str,           # "email" (í•„ìˆ˜)
    "subject": str,        # ì´ë©”ì¼ ì œëª©
    "sender": str,         # ë°œì‹ ì ì´ë¦„
    "body": str,           # ì´ë©”ì¼ ë³¸ë¬¸
    "content": str,        # ì´ë©”ì¼ ë³¸ë¬¸ (ëŒ€ì²´ í•„ë“œ)
    "date": str,           # ìˆ˜ì‹  ì‹œê°„ (ISO 8601 í˜•ì‹)
    "timestamp": str,      # ìˆ˜ì‹  ì‹œê°„ (ëŒ€ì²´ í•„ë“œ)
    "sender_email": str,   # ë°œì‹ ì ì´ë©”ì¼ (ì„ íƒ)
    "recipients": List[str],  # ìˆ˜ì‹ ì ëª©ë¡ (TO)
    "cc": List[str],       # ì°¸ì¡° ëª©ë¡ (ì„ íƒ)
    "bcc": List[str],      # ìˆ¨ì€ì°¸ì¡° ëª©ë¡ (ì„ íƒ)
}
```

### TODO ì•„ì´í…œ ìŠ¤í‚¤ë§ˆ
```python
{
    "id": str,             # TODO ê³ ìœ  ID
    "source_message": {    # ì›ë³¸ ë©”ì‹œì§€ ì •ë³´
        "msg_id": str,     # ë©”ì‹œì§€ ID (í•„í„°ë§ì— ì‚¬ìš©)
        "type": str,
        "subject": str,
        # ... ê¸°íƒ€ í•„ë“œ
    }
}
```

## ë‚´ë¶€ ë©”ì„œë“œ

### ê³µê°œ ë©”ì„œë“œ
- `update_emails(emails: List[Dict], todo_items: List[Dict] = None)`: ì´ë©”ì¼ ëª©ë¡ ì—…ë°ì´íŠ¸ ë° í•„í„°ë§
- `clear()`: ì´ë©”ì¼ ëª©ë¡ ì´ˆê¸°í™”

### ë¹„ê³µê°œ ë©”ì„œë“œ
- `_init_ui()`: UI ì´ˆê¸°í™”
- `_filter_non_todo_emails(emails: List[Dict]) -> List[Dict]`: TODOì— ì—†ëŠ” ì´ë©”ì¼ë§Œ í•„í„°ë§
- `_on_email_clicked(item: QListWidgetItem)`: ì´ë©”ì¼ í´ë¦­ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ âœ¨ NEW

## í•„í„°ë§ ë¡œì§

### TODO ê¸°ë°˜ í•„í„°ë§
```python
def _filter_non_todo_emails(self, emails: List[Dict]) -> List[Dict]:
    """TODO ë¦¬ìŠ¤íŠ¸ì— ì—†ëŠ” ì´ë©”ì¼ë§Œ í•„í„°ë§"""
    filtered = []
    for email in emails:
        # ì´ë©”ì¼ íƒ€ì…ë§Œ í•„í„°ë§
        if email.get("type", "").lower() != "email":
            continue
        
        # TODOì— í¬í•¨ë˜ì§€ ì•Šì€ ì´ë©”ì¼ë§Œ ì¶”ê°€
        msg_id = email.get("msg_id") or email.get("id")
        if msg_id and msg_id not in self.todo_message_ids:
            filtered.append(email)
    
    return filtered
```

### ì´ë©”ì¼ í´ë¦­ ì²˜ë¦¬ (v1.2.1+++++++++++++++++++++++ ì‹ ê·œ) âœ¨
```python
def _on_email_clicked(self, item: QListWidgetItem):
    """ì´ë©”ì¼ í´ë¦­ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬"""
    # í´ë¦­ëœ ì•„ì´í…œì˜ ì¸ë±ìŠ¤ ê°€ì ¸ì˜¤ê¸°
    row = self.email_list.row(item)
    
    # TODOì— ì—†ëŠ” ì´ë©”ì¼ ëª©ë¡ì—ì„œ í•´ë‹¹ ì´ë©”ì¼ ì°¾ê¸°
    filtered_emails = self._filter_non_todo_emails(self.emails)
    
    if row < 0 or row >= len(filtered_emails):
        logger.warning(f"ìœ íš¨í•˜ì§€ ì•Šì€ ì´ë©”ì¼ ì¸ë±ìŠ¤: {row}")
        return
    
    email = filtered_emails[row]
    
    # MessageDetailDialogë¥¼ ì‚¬ìš©í•˜ì—¬ ì´ë©”ì¼ ìƒì„¸ í‘œì‹œ
    from ui.message_detail_dialog import MessageDetailDialog
    
    summary_group = {
        "period_label": email.get("subject", "ì´ë©”ì¼ ìƒì„¸"),
        "statistics_summary": f"ë°œì‹ : {email.get('sender', 'Unknown')}",
        "total_messages": 1,
        "email_count": 1,
        "messenger_count": 0
    }
    
    dialog = MessageDetailDialog(summary_group, [email], self)
    dialog.exec()
```

### ë¡œê¹…
```python
# ì •ë³´ ë¡œê·¸: í•„í„°ë§ ê²°ê³¼ ìš”ì•½
logger.info(f"ğŸ“§ TODOì— ì—†ëŠ” ì´ë©”ì¼: {len(filtered)}ê±´ (ì „ì²´ {len(emails)}ê±´)")

# ê²½ê³  ë¡œê·¸: ìœ íš¨í•˜ì§€ ì•Šì€ ì¸ë±ìŠ¤
logger.warning(f"ìœ íš¨í•˜ì§€ ì•Šì€ ì´ë©”ì¼ ì¸ë±ìŠ¤: {row}")

# ì—ëŸ¬ ë¡œê·¸: ì˜ˆì™¸ ë°œìƒ
logger.error(f"ì´ë©”ì¼ í´ë¦­ ì²˜ë¦¬ ì˜¤ë¥˜: {e}", exc_info=True)
```

## í–¥í›„ ê°œì„  ì‚¬í•­

- [x] ì´ë©”ì¼ í´ë¦­ ì‹œ ìƒì„¸ ì •ë³´ íŒì—… âœ… v1.2.1+++++++++++++++++++++++
- [ ] ìš°ì„ ìˆœìœ„ë³„ ìƒ‰ìƒ ì½”ë”©
- [ ] ì´ë©”ì¼ ë¯¸ë¦¬ë³´ê¸° íˆ´íŒ
- [ ] ë”ë¸” í´ë¦­ vs ì‹±ê¸€ í´ë¦­ ë™ì‘ êµ¬ë¶„
- [ ] ì´ë©”ì¼ ê²€ìƒ‰ ê¸°ëŠ¥
- [ ] ë°œì‹ ìë³„ í•„í„°ë§
- [ ] ë‚ ì§œ ë²”ìœ„ í•„í„°ë§
- [ ] ì½ìŒ/ì•ˆì½ìŒ ìƒíƒœ í‘œì‹œ
- [ ] ì´ë©”ì¼ ì •ë ¬ ì˜µì…˜ (ë‚ ì§œ, ë°œì‹ ì, ì œëª©)

## ê´€ë ¨ íŒŒì¼

- `ui/email_panel.py`: ì»´í¬ë„ŒíŠ¸ êµ¬í˜„
- `ui/main_window.py`: GUI í†µí•©
- `main.py`: ë©”ì‹œì§€ ìˆ˜ì§‘ ë° ë¶„ì„
- `.kiro/specs/ui-improvements/requirements.md`: ìš”êµ¬ì‚¬í•­ ë¬¸ì„œ

## ì°¸ê³  ìë£Œ

- [PyQt6 QListWidget ë¬¸ì„œ](https://doc.qt.io/qt-6/qlistwidget.html)
- [PyQt6 QWidget ë¬¸ì„œ](https://doc.qt.io/qt-6/qwidget.html)
- Smart Assistant UI/UX ê°œì„  ìŠ¤í™

